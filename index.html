<!doctype html>
<html lang="es-AR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <title>Randomizador de Lista</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <style>
    :root{
      --bg:#0b0b0e;
      --panel:#12121a;
      --ink:#e9e9f2;
      --muted:#a7a7b5;
      --accent:#00ff7f;
      --danger:#ff3b3b;
      --radius:18px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 800px at 20% 10%, rgba(0,255,127,.08), transparent 60%),
                  radial-gradient(900px 600px at 80% 90%, rgba(0,180,255,.06), transparent 55%),
                  var(--bg);
      color:var(--ink);
      min-height:100vh;
    }

    .app{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px;
    }

    header{
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:14px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .title{
      font-size:18px;
      font-weight:800;
      letter-spacing:.3px;
    }
    .subtitle{
      font-size:13px;
      color:var(--muted);
    }

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media (min-width: 900px){
      .grid{ grid-template-columns: 1.15fr .85fr; }
    }

    button{
      appearance:none;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--ink);
      border-radius: 14px;
      padding: 12px 14px;
      font-weight:700;
      cursor:pointer;
      transition: transform .05s ease, border-color .15s ease, background .15s ease;
    }
    button:hover{ border-color: rgba(0,255,127,.45); background: rgba(0,255,127,.08); }
    button:active{ transform: translateY(1px); }
    button.primary{
      background: rgba(0,255,127,.12);
      border-color: rgba(0,255,127,.45);
    }
    button.danger{
      background: rgba(255,59,59,.10);
      border-color: rgba(255,59,59,.35);
    }
    button.danger:hover{
      border-color: rgba(255,59,59,.60);
      background: rgba(255,59,59,.14);
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .row > *{ flex: 1; }
    .row .tight{ flex: 0 0 auto; }

    label{
      display:block;
      font-size:13px;
      color:var(--muted);
      margin-bottom:6px;
    }

    input[type="text"], textarea{
      width:100%;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      color: var(--ink);
      padding: 12px 12px;
      font-family: var(--mono);
      outline:none;
    }
    input[type="text"]:focus, textarea:focus{
      border-color: rgba(0,255,127,.55);
      box-shadow: 0 0 0 4px rgba(0,255,127,.10);
    }
    textarea{
      min-height: 300px;
      resize: vertical;
      line-height: 1.45;
    }

    .hint{
      font-size:12px;
      color: var(--muted);
      margin-top:8px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      padding: 6px 10px;
      background: rgba(255,255,255,.04);
      font-size:12px;
      color: var(--muted);
      font-family: var(--mono);
    }
    .dot{
      width:10px; height:10px; border-radius:99px; background: var(--accent);
      box-shadow: 0 0 0 4px rgba(0,255,127,.10);
    }

    /* Fullscreen overlay */
    .overlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      background: #000;
      z-index: 9999;
      padding: 18px;
    }
    .overlay.show{ display:flex; }

    .overlay-inner{
      width:100%;
      height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 18px;
      text-align:center;
    }
    .big{
      font-family: var(--mono);
      font-weight: 900;
      letter-spacing: .5px;
      font-size: clamp(36px, 8vw, 96px);
      color: var(--ink);
    }
    .count{
      font-family: var(--mono);
      font-weight: 900;
      font-size: clamp(60px, 12vw, 140px);
      color: var(--accent);
      text-shadow: 0 0 24px rgba(0,255,127,.35);
    }
    .overlay-actions{
      position: fixed;
      top: 14px;
      right: 14px;
      display:flex;
      gap:10px;
      z-index: 10000;
    }
    .overlay-actions button{
      padding: 10px 12px;
      border-radius: 12px;
    }

    .warn{
      font-size:12px;
      color: var(--muted);
      margin-top: 10px;
      line-height: 1.35;
    }
    .warn strong{ color: #ffd27d; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="title">Randomizador (PWA)</div>
        <div class="subtitle">Bot√≥n ‚Üí cuenta atr√°s (5s) ‚Üí palabra random en pantalla completa</div>
      </div>
      <div class="pill"><span class="dot"></span><span id="status">listo</span></div>
    </header>

    <div class="grid">
      <section class="panel">
        <h2 style="margin:0 0 10px 0; font-size:16px;">Pantalla principal</h2>
        <div class="row" style="margin-bottom:10px;">
          <button id="btnRun" class="primary">üé≤ Tirar palabra</button>
          <button id="btnReset" class="danger tight" title="Restaurar lista por defecto">‚Ü∫ Reset</button>
        </div>
        <div class="hint">
          Consejo: en Android, abr√≠ esta web en Chrome ‚Üí men√∫ ‚ãÆ ‚Üí <strong>‚ÄúAgregar a pantalla principal‚Äù</strong>.
        </div>
        <div class="warn">
          <strong>Nota</strong>: la lista inicial es neutral. Evit√° usar esto para hostigar o degradar personas/grupos.
        </div>
      </section>

      <section class="panel">
        <h2 style="margin:0 0 10px 0; font-size:16px;">ABM de lista</h2>

        <div style="margin-bottom:10px;">
          <label for="newItem">Alta (agregar √≠tem)</label>
          <div class="row">
            <input id="newItem" type="text" placeholder="Escrib√≠ 1‚Äì2 palabras (ej: ‚Äúpueblos ind√≠genas‚Äù)" />
            <button id="btnAdd" class="tight">Agregar</button>
          </div>
        </div>

        <div style="margin-bottom:10px;">
          <label for="listEditor">Edici√≥n masiva (1 √≠tem por l√≠nea)</label>
          <textarea id="listEditor" spellcheck="false"></textarea>
          <div class="row" style="margin-top:10px;">
            <button id="btnSave" class="primary">Guardar</button>
            <button id="btnSort" class="tight" title="Ordenar alfab√©ticamente">Ordenar</button>
            <button id="btnDedup" class="tight" title="Quitar duplicados">Deduplicar</button>
          </div>
          <div class="hint" id="countHint">‚Äî</div>
        </div>
      </section>
    </div>
  </div>

  <!-- Fullscreen overlay -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="overlay-actions">
      <button id="btnClose" class="danger">‚úï Cerrar</button>
    </div>
    <div class="overlay-inner">
      <div id="overlayMain" class="count">5</div>
      <div id="overlaySub" class="hint">Preparando‚Ä¶</div>
    </div>
  </div>

<script>
(() => {
  "use strict";

  const STORAGE_KEY = "randomizador.lista.v1";

  // Lista inicial NEUTRAL (vos la pod√©s editar desde el ABM)
  const DEFAULT_LIST = [
    "pueblos ind√≠genas",
    "afrodescendientes",
    "minor√≠as ling√º√≠sticas",
    "lengua de se√±as",
    "comunidades migrantes",
    "refugiados",
    "personas ap√°tridas",
    "minor√≠as religiosas",
    "jud√≠os",
    "musulmanes",
    "budistas",
    "personas LGBT",
    "personas trans",
    "personas no binarias",
    "personas intersex",
    "personas con discapacidad",
    "discapacidad visual",
    "discapacidad auditiva",
    "neurodivergencias",
    "autismo",
    "TDAH",
    "enfermedades raras",
    "adultos mayores",
    "ni√±ez institucionalizada",
    "personas sin techo",
    "trabajo informal",
    "comunidades rurales",
    "personas detenidas",
    "personas indocumentadas",
    "Indios", "Originarios", "Abor√≠genes", "Comunidades rancho", "Paisanos",
"Negros", "Negros pobres", "Afro", "Morochos", "Marrones",
"Gitanos", "Roman√≠", "Cirujas", "N√≥mades",
"Bolitas", "Paraguayos", "Perucas", "Venezolanos", "Senegaleses", "Chinos", "√Årabes", "Turcos", "Gringos",
"Refugiados", "Exiliados", "Sin papeles",
"Jud√≠os", "Ortodoxos", "Musulmanes", "Evangelios", "Umbanda", "Macumberos", "Ateos",
"Putas", "Putos", "Tortas", "Travas", "Travestis", "Trans", "No binarie", "Intersex", "Asex",
"Discapacitados", "Rengos", "Ciegos", "Sordos", "Muditos",
"Autistas", "Asperger", "TDAH", "Neurodiversos",
"Locos", "Psiqui√°tricos", "Bipolares",
"Viejos", "Jubilados", "Ancianos",
"Pibes", "Menores",
"Pobres", "Muy pobres", "Indigentes", "Sin techo", "Linyeras", "Cartoneros", "Villeros",
"Laburantes negros", "Informales",
"Campesinos", "Rurales", "Gente monte",
"Presos", "Encanados", "Detenidos",
"Sin DNI", "Indocumentados",
"Zurditos", "Fachos", "Disidentes", "Opositores",
"Otakus", "Raros", "Alternativos", "Freaks", "Furros", "Therians", "Gymbros", "Mat√≠as"
  ];

  // Elements
  const statusEl = document.getElementById("status");
  const btnRun = document.getElementById("btnRun");
  const btnClose = document.getElementById("btnClose");
  const btnReset = document.getElementById("btnReset");

  const newItem = document.getElementById("newItem");
  const btnAdd = document.getElementById("btnAdd");

  const listEditor = document.getElementById("listEditor");
  const btnSave = document.getElementById("btnSave");
  const btnSort = document.getElementById("btnSort");
  const btnDedup = document.getElementById("btnDedup");
  const countHint = document.getElementById("countHint");

  const overlay = document.getElementById("overlay");
  const overlayMain = document.getElementById("overlayMain");
  const overlaySub = document.getElementById("overlaySub");

  // State
  let list = loadList();
  renderEditor();

  function setStatus(msg){
    statusEl.textContent = msg;
  }

  function normalizeLines(text){
    return text
      .split(/\r?\n/g)
      .map(s => s.trim())
      .filter(Boolean);
  }

  function renderEditor(){
    listEditor.value = list.join("\n");
    countHint.textContent = `${list.length} √≠tems`;
  }

  function saveList(nextList){
    list = nextList;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    renderEditor();
    setStatus("guardado");
    setTimeout(() => setStatus("listo"), 600);
  }

  function loadList(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return [...DEFAULT_LIST];
      const parsed = JSON.parse(raw);
      if(Array.isArray(parsed) && parsed.length) return parsed.map(x => String(x)).filter(Boolean);
      return [...DEFAULT_LIST];
    } catch {
      return [...DEFAULT_LIST];
    }
  }

  function resetList(){
    saveList([...DEFAULT_LIST]);
  }

  function pickRandom(){
    if(!list.length) return null;
    const i = Math.floor(Math.random() * list.length);
    return list[i];
  }

  function openOverlay(){
    overlay.classList.add("show");
    overlay.setAttribute("aria-hidden", "false");
    // Intento de fullscreen real (puede fallar seg√∫n el navegador/gesto)
    requestFullscreenSafe(overlay);
  }

  function closeOverlay(){
    overlay.classList.remove("show");
    overlay.setAttribute("aria-hidden", "true");
    exitFullscreenSafe();
    overlayMain.textContent = "5";
    overlayMain.className = "count";
    overlaySub.textContent = "‚Äî";
  }

  async function requestFullscreenSafe(el){
    try{
      if (document.fullscreenElement) return;
      if (el.requestFullscreen) await el.requestFullscreen();
    } catch {/* ignore */}
  }

  async function exitFullscreenSafe(){
    try{
      if (document.fullscreenElement && document.exitFullscreen) await document.exitFullscreen();
    } catch {/* ignore */}
  }

  async function runSequence(){
    if(!list.length){
      alert("La lista est√° vac√≠a. Agreg√° √≠tems primero.");
      return;
    }

    btnRun.disabled = true;
    openOverlay();

    // countdown 5..1
    overlayMain.className = "count";
    overlaySub.textContent = "Cuenta atr√°s‚Ä¶";
    for(let t = 5; t >= 1; t--){
      overlayMain.textContent = String(t);
      await wait(1000);
    }

    // show word fullscreen
    const word = pickRandom();
    overlayMain.className = "big";
    overlayMain.textContent = word ?? "‚Äî";
    overlaySub.textContent = "Toc√° ‚ÄúCerrar‚Äù para volver";
    btnRun.disabled = false;
  }

  function wait(ms){
    return new Promise(res => setTimeout(res, ms));
  }

  // Events
  btnRun.addEventListener("click", runSequence);
  btnClose.addEventListener("click", closeOverlay);

  btnAdd.addEventListener("click", () => {
    const v = newItem.value.trim();
    if(!v) return;
    list.push(v);
    newItem.value = "";
    saveList(list);
  });

  newItem.addEventListener("keydown", (e) => {
    if(e.key === "Enter"){
      e.preventDefault();
      btnAdd.click();
    }
  });

  btnSave.addEventListener("click", () => {
    const lines = normalizeLines(listEditor.value);
    saveList(lines);
  });

  btnSort.addEventListener("click", () => {
    const lines = normalizeLines(listEditor.value)
      .sort((a,b) => a.localeCompare(b, "es", { sensitivity: "base" }));
    saveList(lines);
  });

  btnDedup.addEventListener("click", () => {
    const lines = normalizeLines(listEditor.value);
    const seen = new Set();
    const out = [];
    for(const s of lines){
      const k = s.toLocaleLowerCase("es-AR");
      if(seen.has(k)) continue;
      seen.add(k);
      out.push(s);
    }
    saveList(out);
  });

  btnReset.addEventListener("click", () => {
    const ok = confirm("¬øRestaurar la lista por defecto? Vas a perder la lista guardada.");
    if(ok) resetList();
  });

  // PWA: register service worker
  if("serviceWorker" in navigator){
    window.addEventListener("load", async () => {
      try{
        await navigator.serviceWorker.register("./sw.js");
      } catch (e) {
        // no-op
      }
    });
  }
})();
</script>
</body>
</html>
